<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
This is an example weekly progress report document that team members can use to report their individual progress 
of their ECE477 senior design projects. Weekly progress reports are expected to follow the general guidelines
presented in the "Progress Report Policy" document, available online at https://engineering.purdue.edu/ece477/Course/Policies/policies.html

Please create 4 copies of this example, renaming each copy to <PurdueID>.html, where <PurdueID> corresponds to
the Purdue ITAP Career Account ID given by Purdue to each individual team member. If you have any questions,
contact course staff.
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!--Reconfigurable base tag; used to modify the site root location for root-relative links-->
<!--<base href="https://engineering.purdue.edu/ece477/StudentWebTemplate/" />-->

<!--Content-->
<title>ECE477 Progress Report</title>
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="author" content="George Hadley">
<meta name = "format-detection" content = "telephone=no" />
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!--CSS-->
<link rel="stylesheet" href="../../css/default.css" type="text/css" media="all" />
<link rel="stylesheet" href="../../css/responsive.css">
<link rel="stylesheet" href="../../css/styles.css">
<link rel="stylesheet" href="../../css/content.css">
<!--[if IE 6]>
<link href="default_ie6.css" rel="stylesheet" type="text/css" />
<![endif]-->

</head>
<body>
<div id="wrapper_site">
    <div id="wrapper_page">
	<!-- Instantiate global site header.-->
	<div id="header"></div>
		<!-- Instantiate site global navigation bar.-->
		<div id="menu"></div>

		<!-- Instantiate a page banner image. Page banner images should be 1100x350px and should be located within the local
			img folder located at this directory level. -->
		<div id="banner">
			<img src="../../Files/img/BannerImgExample.jpg"></img>
		</div>

		<!-- Instantiate "tools" needed for a page. Tools are premade functional blocks that can be used to build a page,
			and include things such as a file lister (for listing out homework assignments or tutorials)
		-->
		<div id="content">
            <h2>Progress Report for Peter Sumner</h2>

            <h4>Week 3:</h4>
            <b>Date:</b> 9-9-2020<br>
            <b>Total hours:</b> 6<br>
            <b>Description of design efforts:</b><br>
			<td>Throughout the project I will be working on implementing the GPS module. The focus of this week was to research GPS operation and possible 
				GPS modules to use. GPS receivers use a satellite constellation of at least 24 satellites to calculate potision at a given time. To do this calculation 
				accurately the receiver must be able to lock onto 4 satellites and the satellite configuration ensures that this is always possible [1]. 
				<br>
			</td>
			<table>
				<tr>
					<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
						<a href = "https://cdn.sparkfun.com/r/700-700/assets/0/3/9/5/8/50db5859ce395f0c2a000002.gif">
						<img src="../img/sumner3_progress/GPS_Sat.gif" style="height: 200px;"><br><b>Figure 1: Constellation of Orbiting Satellites [1]</i></td>
					</a>
					<td>Only basic functionality of a GPS is needed to receive coordinate and alititude data as required for the project. Since the GPS 
						requirements are minimal, the feature I determined to be most important was power consumption. The goggles will be battery operated for hours at 
						a time and selecting low power components is key. Some modules, like the MTK3339 by Adafruit, have a sleep mode that can be activated to lower
						consumption further [2]. The GPS will only be actively receiving when requested by the user so this could be a useful fucntion.<br>
					</td>
				</tr>
			</table>
			
			<td><br>
				The next step is to aqcuire the physical GPS module and begin experimenting with its functionality.
			</td>
			<br>
			<h4>Week 4:</h4> 
			<b>Date:</b> 9-18-2020<br>
			<b>Total hours:</b> 6<br>
			<b>Description of design efforts:</b><br>
			<table>
				<td>This week I ordered a GPS breakout, specifically the Ultimate GPS Breakout from Adafruit [3]. Unfortunately, the parts did not arrive in time 
					to begin working with the module this week. Nevertheless, I did some digging to determine how to properly program the GPS and set up a testing 
					environment with Arduino. Adafruit has published a GPS library compatible with the module that is open-source and can be found on GitHub [4].
					The relevant functions and variables to this project are found in the header file. The GPS module can be connected via either SPI or I2C and in 
					addition to housing functions, the library also contains basic examples for how each could be structured. 
					<br>
				
				</td>
				<td style="text-align: center; vertical-align: top; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
					<a href = "https://cdn-shop.adafruit.com/970x728/746-11.jpg">
					<img src="../img/sumner3_progress/GPS_Breakout.png" style="height: 200px;"><br><b>Figure 1: Ultimate GPS Breakout [3]</b>
					<br>
				</a>
				</td>
			</table>
			<br>
			<table>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
					<img src="../img/sumner3_progress/Arduino_GPS_Test.jpg" style="width: 600px;"><br><b><u>Figure 2: Experimental Setup With Arduino</u></b>
				<td>A portion of an Arduino script is shown on the left that establishes working communication with the GPS module. The setup section
					sets the baud rate and configures the GPS output. It then enters a loop as the GPS receives and digests data. GPS data is packaged in the form of National Marine 
					Electronics Association (NMEA) sentences [5]. Each sentence contains all of the data collected for a specific point in time. When the GPS receives an NMEA sentence 
					each variable must be extracted individually. <br>
				<br>As data for each of the individual variables is collected it is printed to the console output. Once the hardware portion is implemented, this will enable 
					me to assess the accuracy of data received as well as mirror the display a goggle wearer will have in the final implementation of the project.
				</td>
			</table>
			<br>
			<h4>Week 5:</h4>
			<b>Date:</b> 9-25-2020<br>
			<b>Total hours: </b>16<br>
			<b>Description of design efforts:</b><br>
	 		<td>This week I began working with the GPS module using an Arduino Uno. The wiring of the module is shown in Figure 1. On the right side of the 
				photo is a wire that extends from the GPS breakout board. This connects to the GPS antenna (Figure 2) that must be placed outside or it 
				will struggle to properly get a location fix on any satellites. 
			</td>
			<br><br>
			<table>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;"> 
					<img src="../img/sumner3_progress/Arduino_GPS_Setup.jpg" style="width: 550px;"><br><b><u>Figure 1: Arduino GPS Module Wiring</u></b>
					<br>
				</td>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;"> 
					<img src="../img/sumner3_progress/GPS_Outside.jpg" style="width: 300px;"><br><b><u>Figure 2: GPS Antenna Setup</u></b>
					<br>
				</td>
			</table>
			<br>
			<td>When I first attempted to connect to the GPS and request data, I was couldn't get the GPS antenna to get a fix. I was able to receive empty sets of
				data through the Arduino, so even though everything was connected properly on my end the antenna was not acquiring satellite signals. The 
				solution to this ended up being to wait for about 30 minutes and then data finally started to come in. The raw GPS data is received in the format of NMEA
				sentences which are somewhat readable to the eye but not very useful until they are parsed. I utilized the Adafruit GPS library [4] to successfully parse 
				the data and output in a useful format to the Arduino serial monitor. I included a screen capture of my serial output below in Figure 3. There 
				are two sets of data from two timestamps and for each set I printed the time, date, fix status, location, speed, angle, altitude, and number of 
				satellites. The last four lines that begin with "$GPXXX" show the NMEA sentence data format that I echoed to the output for debugging purposes.
			</td>
			<br><br>
			<table>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
					<img src="../img/sumner3_progress/Arduino_GPS_Output.jpg" style="width: 950px;"><br><b><u>Figure 3: GPS Data Captured From Arduino Serial Monitor</u></b>
					<br>
				</td>
			</table>
			<br>
			<td>Acquiring data from the GPS is an exciting milestone for this portion of the project. While stationed in my room, the GPS gives accurate data 
				and now the next steps will be to test the accuracy as location and speed change and then to implement the functionality using the chosen STM32
				microcontroller. Another factor I will need to keep in mind is the time taken to acquire a location fix and I will be looking into ways to 
				minimize this as much as possible.
			</td>
			<br><br>
			<h4>Week 6:</h4>
			<b>Date:</b> 10-2-2020<br>
			<b>Total hours: </b>10<br>
			<b>Description of design efforts:</b><br>
			<td>This week I worked more with the GPS module using Arduino. After getting the GPS to connect last week I wanted to verify that I was properly 
				utilizing the GPS module and receiving accurate information. For the project it is important that the GPS provides accurate location information 
				and updates itself quickly. Most people who use their phone for navigation, including myself, have probably experienced the annoyance of their 
				GPS location on screen lagging behind their actual location. I had a friend drive around to assess the accuracy of the readings I was getting from 
				the GPS as I changed location. We stopped outside of Igloo Frozen Custard in West Lafayette to check coordinate and altitude data.<br><br> 
				The actual location data for this point is: <br>

				<b>Latitude: </b>40.3680<br>
				<b>Longitude: </b>-86.8755<br>
				<b>Altitude: </b>193m [6]<br><br>

				And the reported GPS data was:<br>
				<b>Latitude: </b>40.3678<br>
				<b>Longitude: </b>-86.8742<br>
				<b>Altitude: </b>195.1<br><br>

				Considering I took the measurements from the parking lot and could not go inside for the most accurate results, these numbers are quite 
				acceptable. I configured the GPS to print an update on its current state every second and noticed that while the coordinates remained consistent, 
				the altitude data would change a bit each time but remained within about two meters of the target value. For the future, I think altitude may need 
				to be calculated as the average of several measurements. <br><br>

				I also wanted to make sure that the GPS was not lagging as it reported data. This would have been difficult to test using purely coordinate data 
				because I didn't know what my coordinates should have been at every data point. I also didn't trust that comparing to another GPS would be 
				guarantee unbiased results. I instead used speed as the metric to verify that the GPS was updating fast enough. In a car it was very easy to 
				check the correct speed by looking at the odometer. While driving around, I quickly found out that the GPS was giving speed in knots and made that
				adjustment to my code. <br><br>

				Below is some footage from the excursion that shows the GPS in action. The first video in Figure 1 shows the location data from Igloo and Figure 3 
				shows the car's odometer compared to the GPS output. Figures 2 and 4 show screenshots from the videos to more easily read the data.<br><br>
			</td>
			<table align="center">		
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">	
					<video width="400" controls>
						<source src="../img/sumner3_progress/GPS_Location_Test.mp4" type=video/mp4>
					</video> <br><b><u>Figure 1: GPS Location Verification</u></b>
				</td>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
					<img src="../img/sumner3_progress/GPS_Location_SS.jpg" style="width: 400px;"><br><b><u>Figure 2: GPS Data Captured From Arduino Serial Monitor</u></b>
					<br>
				</td>
			</table><br>
			<table align="center">		
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">	
					<video width="400" controls>
						<source src="../img/sumner3_progress/GPS_Speed_Test.MOV" type=video/mp4>
					</video> <br><b><u>Figure 3: GPS Speed Verification</u></b>
				</td>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
					<img src="../img/sumner3_progress/GPS_Speed_SS.jpg" style="width: 400px;"><br><b><u>Figure 4: GPS Data Captured From Arduino Serial Monitor</u></b>
					<br>
				</td>
			</table><br>
			<td>For next week I hope to begin working with the GPS module and the microcontroller we have chosen for the project.</td><br><br>
			<h4>Week 7:</h4>
			<b>Date:</b> 10-9-2020<br>
			<b>Total hours:</b> 8<br>
			<b>Description of design efforts:</b><br>
			<td>Continuing with the GPS module, this week my goal was to move on from the Arduino IDE and implement a physical trigger to request data from 
				the GPS. I had hoped to get the module working with our STM32 microcontroller this week, but it unfortunately arrived too late for me to use it 
				this week. Instead I used an ESP32 feather board with Micropython. With the Arduino I couldn't connect any other hardware in addition to the GPS
				without causing it to lose functionality. The module would continue to communicate with the Arduino but would always lose its satellite signal. 
				Using the ESP32 got rid of this issue and I integrated a push button to trigger the GPS request. In the final project, there will be a button 
				that the user will be able to push to request the GPS data of a buddy nearby.<br><br>

				The GPS module uses UART to connect to the microcontroller. Once it has acquired a satellite connection, it can begin to send transmit data. The 
				data has to be parsed into data arrays. There are several types of NMEA senteces that the module will transmit that contain different assortments 
				of data. For our purposes, all of the necessary data can be pulled from just two types, which simplifies things. Sentences are structured as a 
				comma separated list, making it easy to split apart. <br><br>

				I also updated our product CAD model this week. As we have progressed further in the process of desiging our PCB, there were some physical changes 
				to account for. Originally we were going to use two user push buttons for the on/off switch and the GPS trigger. While designing the PCB we decided 
				to change the power button to a dip switch. The dimensions and general layout also changed through this process, so the size and positioning of the 
				user interface was also adjusted. <br><br>
			</td>
			<table>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
					<img src="../img/sumner3_progress/CAD_Progress.jpg" style="width: 400px;"><br><b><u>Figure 1: CAD model progress</u></b>
					<br>
				</td>
			</table>
			<td>With the model, there are still a couple things left to figure out that have changed since the original model. We're now using a different radio 
				chip and antenna and will be adding that back to the model once the kind of antenna is decided on. The placement of the OLED may also change but 
				more prototyping is needed before determening its final placement.<br><br>
				
				The next step for me is to actually use the STM32 microcontroller for the GPS implementation. I will be using the same hardware design with a push button 
				to request data from the GPS. I anticipate that parsing to be more tedious moving from Python to C, but the process will hopefully go smoothly. 
			</td><br><br>
			<h4>Week 9:</h4>
			<b>Date:</b> 10-23-2020<br>
			<b>Total hours:</b> 6<br>
			<b>Description of design efforts:</b><br>
			<td>I was able to use the STM32L4 Discovery Board to work with the GPS module. A picture of the wiring with the discovery board is shown below in Figure 1. The pins used for 
				UART TX and UART RX with the GPS are not what will be used in the final implementation of the project with the PCB. These pins will be used with the LoRa Radio, but 
				the GPS pins we are using are not assigned a header pin on the discovery board. The pinout I used to generate the project for this test is shown in Figure 2.<br>
			</td>
			<table>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
					<img src="../img/sumner3_progress/STM_GPS_Wiring.JPG" style="width: 440px;"><br><b><u>Figure 1: STM32L4 Discovery Board Wiring with GPS Module</u></b>
					<br>
				</td>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
					<img src="../img/sumner3_progress/STM_GPS_Pinout.jpg" style="width: 340px;"><br><b><u>Figure 2: STM32L4 Pinout for GPS Test</u></b>
					<br>
				</td>
			</table>
			<td>The actual code for the GPS is not terribly complex. I set up the micro to receive information from the chip and it is received in the NMEA format just like
				in my previous methods. Parsing in C is more tedious and time consuming than with Python, but the process is pretty much the same. The comma separated 
				structure makes it fairly easy to pull out the data.
				<br><br>
				The plan for the coming weeks with this part of the project is to begin integration with some of the other components that have been tested individually. 
				We will likely test the GPS with the IMU first because the IMU is being used to calculate velocity, which is one of our PSSCs. Then the GPS will also be integrated 
				with the LoRa radio so that we can implement the location data request feature.
			</td>
			<h4>Week 10:</h4>
			<b>Date:</b> 10-29-2020<br>
			<b>Total hours:</b> 8<br>
			<b>Description of design efforts:</b><br>
			<td>After having some progress with the STM32 and GPS last week, I feel like I made negative progress this week. The GPS uses UART 
				communication which has several implementation methods in the STM32 software. I was using the polling protocol and was having some
				success getting data from the GPS. This method doesn't work well at baud rates above 9600, which is the minimum baud rate of the GPS.
				Using interrupt protocol will likely be better for working with the hardware and for our software setup. However, since I attempted to 
				switch to using interrupts I now cannot not get any data from the GPS, even when I try to go back to using polling. I've spent a few days
				trying to debug this but am currently stuck.
				<br><br>
				I'm pretty confident that I am initializing the GPS correctly as a USART device and correctly configuring the necessary GPIO pins. I have also
				implemented handlers and initializers to enable the interrupts. 
				<br><br>
				This is the code for initizliaing the GPIO pins:
			</td>
			<table>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
					<img src="../img/sumner3_progress/STM_GPIO_Init.jpg" style="width: 440px;"><br><b><u>Figure 1: STM32 function to initialize GPIO</u></b><br>
				</td>
			</table>
			<td><br>This is the function that I'm calling for USART initialization:
			</td>
			<table>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
					<img src="../img/sumner3_progress/STM_USART2_Init.jpg" style="width: 440px;"><br><b><u>Figure 2: STM32 function to initialize USART2</u></b><br>
				</td>
			</table>
			<td>The USART configuration settings are the same that I used for working with the module on other devices. Once powered on and connected via 
				the transmit pin on the module, the GPS will automatically begin transmitting location data so the STM shouldn't need to transmit anything 
				to the GPS.
				<br><br>
				I'll keep trying to debug the issue over the weekend and if I'm still stuck my next step will be to find a time to go to office hours
				next week. While searching the internet for a solution I found a potentially useful library for parsing the GPS data that would make my
				life a lot easier once I am getting data [7]. 
			</td>
			<h4>Week 11:</h4>
			<b>Date:</b> 11-6-2020<br>
			<b>Total Hours:</b> 12<br>
			<b>Description of design effors:</b><br>
			<td>I was able to move through the roadblock last week working with the GPS and STM32. It took a few days for me to get components to 
				communicate again and I'm not sure if there was just one issue or a combination of things. I changed several things in the debugging process 
				and the issues were mainly with the code generated using the STMCubeMX software. Some of the HAL configuration files were setup incorrectly 
				so I went through those and fixed the USART relevant functions. At one point I was also getting an error "Failed to execute MI command: -var 
				create-" after changing nothing in my code. This ended up being a hardware malfunction with the board that was solved by rebooting and running 
				my code with all the 'meat' commented out. Then I added it back in was able to run it fine.
			</td>
			<table>
				<td style="text-align: center; font-size: 10px; margin-bottom: 0px; padding-right: 10px; line-height: 15px;">
					<img src="../img/sumner3_progress/SystemWorkbench_GPS_Polling_Data.jpg" style="width: 900px;"><br><b><u>Figure 1: Variable showing polled USART GPS data </u></b><br><br>
				</td>
			</table>
			<td>Pictured above is a line of data captured from the GPS using UART polling. Before I was using functions from a GPS compatible library to do 
				most of the data parsing, but to keep things simple I'm going to create my own parsing functions. At the moment I can only receive one line of 
				data with each run, which will be the first thing I look into to fix into the weekend. To keep things simple, I'll also be creating my own 
				functions for parsing instead of using library assistance as before. This will also be done soon because my teammates have also had success 
				with their individual components and we need to start integrating them together. 
			</td>
			<br><br>
			<b>Sources Cited:</b><br>
			<p style="line-height: 20px;">[1] "GPS Basics," sparkfun.com. 2020. [Online] Available at: &lthttps://learn.sparkfun.com/tutorials/gps-basics/all> [Accessed 9 September 2020].<br>
				[2] "Ultimate GPS Module," Adafruit Industries. 2020. [Online] Available at: &lthttps://www.adafruit.com/product/790> [Accessed 8 September 2020].<br>
				[3] "Adafruit Ultiamte GPS Breakout," Adafruit Industries. 2020. [Online] Available at: &lthttps://www.adafruit.com/product/746> [Accessed 15 September 2020].<br>
				[4] "Adafruit_GPS," GitHub. 2020. [Online] Available at: &lthttps://github.com/adafruit/Adafruit_GPS> [Accessed 16 September 2020]. <br>
				[5] "NMEA Data," GPSInformation.org. [Online] Available at: &lthttps://www.gpsinformation.org/dale/nmea.htm#intro> [Accessed 16 September 2020]. <br>
				[6] "Find Google Maps Coordinates," mapcoordiantes.net [Online] Available at: &lthttps://www.mapcoordinates.net/en> [Accessed 2 October 2020]. <br>  
				[7] "nimaltd/GPS," GitHub. 2020. [Online] Available at: &lthttps://github.com/nimaltd/GPS [Accessed 27 October 2020]. <br>
			</p>
        </div>

		<!-- Instantiate global footer. Any changes to the footer should be made through the top-level file "footer.html" -->
		<div id="footer"></div>
    </div>
</div>

<!--JS-->
<script src="../../js/jquery.js"></script>
<script src="../../js/jquery-migrate-1.1.1.js"></script>

<script type="text/javascript">
$(document).ready(function() {
    $("#header").load("../../header.html");
	$("#menu").load("../../navbar.html");
	$("#footer").load("../../footer.html");
});
</script>
</body>
</html>
